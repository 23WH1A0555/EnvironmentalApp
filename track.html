<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Pickup | Waste Management App</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  
  <style>
    body {
      background: url('pic.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    .center-box {
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      color: black;
    }
    .status-pending { color: #ffc107; }
    .status-inprogress { color: #0d6efd; }
    .status-completed { color: #198754; }
    #map { height: 300px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container mt-5">
    <div class="center-box">
      <h2 class="text-center mb-4">Track Your Pickup</h2>

      <div class="mb-4">
        <label for="pickupId" class="form-label">Enter Pickup ID:</label>
        <div class="input-group">
          <input type="text" class="form-control" id="pickupId" placeholder="e.g., 12345" />
          <button class="btn btn-success" id="trackButton">Track</button>
        </div>
      </div>

      <!-- Pickup Status Display -->
      <div id="pickupStatusContainer" style="display: none;">
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            Current Pickup Status
          </div>
          <div class="card-body">
            <h5 class="card-title" id="pickupIdDisplay"></h5>
            <p class="card-text" id="pickupDateDisplay"></p>
            <div class="progress mb-3">
              <div class="progress-bar" id="pickupProgressBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                Pending
              </div>
            </div>
            <ul class="list-group mb-4" id="statusList"></ul>

            <!-- Map Section -->
            <h6>Pickup Truck Location (Hyderabad):</h6>
            <div id="map"></div>
          </div>
        </div>
      </div>

      <!-- Dashboard Button -->
      <div class="text-center">
        <button class="btn btn-outline-success" onclick="window.location.href='dashboard.html'">üè† Back to Dashboard</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Simulated pickup data
    const pickupData = {
      "12345": {
        pickupDate: "March 30, 2025 at 10:00 AM",
        status: "In Progress",
        progress: 50,
        statuses: [
          { label: "Scheduled", statusClass: "status-completed" },
          { label: "Driver Assigned", statusClass: "status-completed" },
          { label: "In Transit", statusClass: "status-inprogress" },
          { label: "Completed", statusClass: "status-pending" }
        ]
      },
      "67890": {
        pickupDate: "April 1, 2025 at 2:00 PM",
        status: "Completed",
        progress: 100,
        statuses: [
          { label: "Scheduled", statusClass: "status-completed" },
          { label: "Driver Assigned", statusClass: "status-completed" },
          { label: "In Transit", statusClass: "status-completed" },
          { label: "Completed", statusClass: "status-completed" }
        ]
      }
    };

    let map, marker;
    const hyderabadCoords = [17.3850, 78.4867];

    document.getElementById("trackButton").addEventListener("click", function () {
      const pickupId = document.getElementById("pickupId").value.trim();
      const pickup = pickupData[pickupId];

      if (pickup) {
        document.getElementById("pickupStatusContainer").style.display = "block";
        document.getElementById("pickupIdDisplay").textContent = Pickup ID: ${pickupId};
        document.getElementById("pickupDateDisplay").textContent = Scheduled for: ${pickup.pickupDate};

        // Update progress bar
        const progressBar = document.getElementById("pickupProgressBar");
        progressBar.style.width = ${pickup.progress}%;
        progressBar.textContent = pickup.status;
        progressBar.setAttribute("aria-valuenow", pickup.progress);

        // Status list
        const statusList = document.getElementById("statusList");
        statusList.innerHTML = "";
        pickup.statuses.forEach(item => {
          const li = document.createElement("li");
          li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center", item.statusClass);
          li.innerHTML = ${item.label} <span class="badge bg-success rounded-pill">‚úî</span>;
          statusList.appendChild(li);
        });

        // Show Hyderabad map
        showMap(hyderabadCoords);
      } else {
        alert("Pickup ID not found. Please try again.");
      }
    });

    function showMap(coords) {
      if (!map) {
        map = L.map('map').setView(coords, 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Map data ¬© OpenStreetMap contributors'
        }).addTo(map);
        marker = L.marker(coords).addTo(map).bindPopup("Pickup Truck - Hyderabad").openPopup();
      } else {
        map.setView(coords, 13);
        marker.setLatLng(coords).update();
      }
    }
  </script>
</body>
</html>
